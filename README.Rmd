---
output: github_document
---

I love pufferfish

The goal of our project is to find what variables are most prominent when causing crashes that are fatal, have significant crash severity, or cause the most property damage. The variables we are looking at right now include roadway type, roadway surface, environmental/weather conditions, and light conditions. Eventually, we would like to create a model to predict what conditions are most likely to cause serious injuries.

```{r}
library(tidyverse)

#Use this if the below code doesn't work - file must be stored on your device.
#crashes <- read.csv("../Vehicle_Crashes_in_Iowa.csv")
crashes <- read.csv("https://media.githubusercontent.com/media/nathanrethwisch/Team-Pufferfish/main/Vehicle_Crashes_in_Iowa.csv")

#View(crashes)
```

```{r}

dim(crashes)
str(crashes)

#NA values are only found in Amount of Property Damage?
colSums(is.na(crashes))

#This is strange because it appears that City.Name has NA values
sum(is.na(crashes$`City Name`))

#Making blank and N/A value in NA
crashes$`City Name`[crashes$`City Name` == ""] <- NA
crashes$`County Name`[crashes$`County Name` == ""] <- NA
crashes$`Route with System`[crashes$`Route with System` == ""] <- NA
crashes[crashes=="N/A"]<-NA

#Making the case number an integer
crashes$`Law Enforcement Case Number` <- as.integer(crashes$`Law Enforcement Case Number`)

#Checking NA sums after we made changes to the dataset
colSums(is.na(crashes))
```

```{r}
#Getting the distinct latitude and longitude
crashes<- crashes%>%
  separate(col = Location, into = c(NA, "Latitude", "Longitude"), remove =
             FALSE, sep = " ")

crashes<- crashes%>%mutate(Latitude = parse_number(Latitude), Longitude = parse_number(Longitude))
```

```{r}
crashes$`Date of Crash` <- lubridate::mdy(crashes$`Date of Crash`)

#Creating a new columns that are separate for year, month, and day
crashes <- crashes%>%
  separate(col = `Date of Crash`, into = c("Year", "Month", "Day"), remove =
             FALSE, sep = "-")
View(crashes)
```

```{r}
#Looking at the different crash severities
crashes%>%
  group_by(`Crash Severity`)%>%
  summarise(n = n())
```

```{r}
#Roadway contribution to fatal car accidents
crashes%>%
  filter(`Crash Severity` == "Fatal")%>%
  group_by(`Roadway Contribution`)%>%
  summarise(n = n())
```

```{r}
#The count of roadway contributions by injury severity
crashes%>%
  ggplot(aes(x = `Roadway Contribution`)) +geom_bar() + facet_wrap(~`Crash Severity`)+coord_flip()
```

```{r}
#Map of all crashes in Iowa
crashes%>%
      ggplot(aes(x = Latitude, y = Longitude)) + geom_point()
```

```{r}
#Crash severity grouped by roadway type
crashes2<- crashes%>%
  group_by(`Roadway Type`, `Crash Severity`)%>%
  summarise(n = n())

crashes2[which.max(crashes2$n),]

```

```{r}
#The top cause of fatal crashes
crashes3<- crashes%>%
  filter(`Crash Severity` == "Fatal")%>%
  group_by(`Major Cause`)%>%
  summarise(n = n())

crashes3[which.max(crashes3$n),]
```

```{r}
#Looking at the top environmental and surface conditions for fatal accidents
Cause_crashes<- crashes%>%
  filter(`Crash Severity` == "Fatal")%>%
  group_by(`Environmental Conditions`, `Light Conditions`, `Surface Conditions`, `Weather Conditions`)%>%
  summarise(n = n())

Cause_crashes%>%filter(n > 100)
```

```{r}
#Barplot of fatal crashes by light condition
crashes%>%
  filter(`Crash Severity` == "Fatal")%>%
  ggplot(aes(x = `Light Conditions`)) +geom_bar() + coord_flip()
```

```{r fig.height = 10, fig.width = 10}
#Fatal Crashes by Day
crashes%>%
  group_by(Month)%>%
  filter(`Crash Severity` == "Fatal")%>%
  ggplot(aes(x = Day, fill = `Crash Severity`)) +geom_bar() + facet_wrap(~Month) + coord_flip()
```

```{r, fig.height = 15, fig.width = 15}
#All types of crashes by month
crashes%>%
  group_by(Month)%>%
  ggplot(aes(x = Day, fill = `Crash Severity`)) +geom_bar() + facet_wrap(~Month)
```
